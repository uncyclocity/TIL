# 15. 동기와 비동기

> References <br> <a href="http://www.yes24.com/Product/Goods/92742567?OzSrank=1">모던 자바스크립트 Deep Dive</a> _.이웅모_ <br> <a href="https://velog.io/@dami/JS-Microtask-Queue">[JS] Event Loop : 마이크로태스크(Microtask)와 매크로태스크(Macrotask) 알아보기</a> _.dami_

## 1. 동기와 비동기 처리 방식의 정의

- JS 엔진은 **단 하나의 콜스택**을 갖기 때문에, 콜스택의 실행 컨텍스트가 팝되어야 다음 실행 컨텍스트가 실행될 수 있다. <br>
  👉 이러한 특징을 두고 JS 엔진이 **싱글 스레드** 방식이라고 하는 것이다.
- **동기 처리 방식**은 싱글 스레드 특성에 의해 **다음 실행 컨텍스트가 대기하는 방식**을 말한다.
- **비동기 처리 방식**은 동기와 반대로, **현재 실행중인 태스크가 있더라도 다음 태스크를 실행하는 방식**이다.

## 2. 동기 vs 비동기 비교

- **동기 처리 방식**

  - 태스크를 순차적으로 처리하기에 **실행 순서**가 보장된다.
  - 실행 중인 태스크 종료를 대기하는 동안 다음 태스크들이 **블로킹**되어 실행 시간이 길어진다. <br>
    👉 **블로킹**이란? 코드를 수행하기 위해 현재의 JS 및 Non-JS 연산이 끝나는 것을 기다려야 하는 상황

- **비동기 처리 방식**
  - 태스크 실행 완료를 대기하지 않기에 **논블로킹이다.**
  - 태스크 실행 **순서가 보장되지 않는다.**
  - 비동기 처리에 일반적으로 사용되는 **콜백 패턴**은 콜백 지옥으로 인해 **가독성을 떨어뜨린다.** 또한 **에러 처리가 힘들다.** <br>
    👉 프로미스와 async/await를 통해 해결이 가능하다.

## 3. 이벤트 루프와 태스크 큐

<img src="https://media.vlpt.us/images/dami/post/8e5c1b68-101c-4fff-8090-7024ff2730c0/%E1%84%86%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A2%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3.gif">

- **콜 스택**

  - 함수가 호출 될 경우 **실행 컨텍스트**가 생성되고 삭제되는 공간이다.
  - **JS엔진** 영역에 해당한다.

- **마이크로태스크 큐**

  - **Promise를 핸들링하는 비동기 함수의 콜백 함수**가 쌓이는 큐이다. <br>
    👉 **then/catch/finally핸들러** 및 **async/await**등이 해당한다.
  - 매크로태스크 큐보다 실행 순서가 우선이다.

- **매크로태스크 큐**

  - **Promise를 핸들링하지 않는 비동기 함수의 콜백 함수**가 쌓이는 공간이다. <br>
    👉 **setTimeout/setInterval/setImmidiate**등이 해당한다.

- **이벤트 루프**
  - 콜 스택과 태스크 큐를 **루프를 돌며** 계속 주시한다.
  - 콜 스택에 더이상 실행 컨텍스트가 없을 경우 **태스크 큐에 쌓여있는 비동기 함수를 차례대로 콜 스택에 쌓는다.**

## 4. 이벤트 루프 알고리즘

<img src="https://media.vlpt.us/images/dami/post/17f971cc-965f-4b4e-ad08-4b30b2ee1608/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-03-14%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.30.59.png">

```javascript
// 나중에 실행된다.
setTimeout(() => console.log("timeout"));

// 먼저 실행된다.
Promise.resolve().then(() => console.log("promise"));
```

- JS엔진은 하나의 매크로태스크를 처리한 후, 다른 매크로태스크를 처리하기 전에 **마이크로태스크 전부**와 **렌더링**을 수행한다.
